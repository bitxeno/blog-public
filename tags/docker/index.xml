<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>Docker on bitxeno's notes</title><link>https://blog.xenori.com/tags/docker/</link><description>Recent content in Docker on bitxeno's notes</description><generator>Hugo -- gohugo.io</generator><language>zh-cn</language><lastBuildDate>Mon, 22 Nov 2021 14:40:11 +0800</lastBuildDate><atom:link href="https://blog.xenori.com/tags/docker/index.xml" rel="self" type="application/rss+xml"/><item><title>dashå®æ—¶è½¬æ¢hlsæµåª’ä½“æ’­æ”¾</title><link>https://blog.xenori.com/2021/11/dash-to-hls/</link><pubDate>Mon, 22 Nov 2021 14:40:11 +0800</pubDate><guid>https://blog.xenori.com/2021/11/dash-to-hls/</guid><description>&lt;img src="https://blog.xenori.com/2021/11/dash-to-hls/cover.jpeg" alt="Featured image of post dashå®æ—¶è½¬æ¢hlsæµåª’ä½“æ’­æ”¾" />&lt;p>æœ¬æ–‡ä¸»è¦æ˜¯æ¢è®¨ä¸‹bç«™çš„éŸ³è§†é¢‘æµåˆ†ç¦»dashæ ¼å¼å®æ—¶è½¬ä¸ºhlsæµåª’ä½“ï¼Œä»¥æ–¹ä¾¿åœ¨æ—§çš„æ’­æ”¾å™¨ä¸Šæ’­æ”¾ã€‚&lt;/p>
&lt;h2 id="ä»€ä¹ˆæ˜¯dash">ä»€ä¹ˆæ˜¯DASH&lt;/h2>
&lt;p>dashæ˜¯åŸºäºHTTPçš„åŠ¨æ€è‡ªé€‚åº”æµï¼ˆè‹±èªï¼šDynamic Adaptive Streaming over HTTPï¼Œä¹Ÿç§°MPEG-DASHï¼‰çš„ç®€ç§°ã€‚ç°åœ¨bç«™æœ€æ–°çš„è§†é¢‘éƒ½æ˜¯è¿”å›è¿™ç§æ ¼å¼ï¼Œå¹¶ä¸”æ˜¯éŸ³è§†é¢‘åˆ†ç¦»çš„ã€‚bç«™dashå®è·µå¯ä»¥å‚è€ƒè¿™ç¯‡ppt: &lt;a class="link" href="https://www.w3.org/2019/03/23-chinese-web-jianqiang-bilibili.pdf" target="_blank" rel="noopener"
>MPEG-DASHåœ¨bilibiliçš„åº”ç”¨ä¸å®è·µ&lt;/a>&lt;/p>
&lt;h2 id="è½¬æ¢hlsçš„å®ç°æ–¹å¼">è½¬æ¢HLSçš„å®ç°æ–¹å¼&lt;/h2>
&lt;p>bç«™dashéŸ³è§†é¢‘åˆ†åˆ«ä¸ºå•ç‹¬çš„ä¸¤ä¸ªé“¾æ¥ï¼Œä¸åŒçš„ç ç‡å’Œç¼–ç å¯¹åº”ä¸åŒçš„é“¾æ¥ï¼Œä¸‹é¢åªæ˜¯ä½¿ç”¨å…¶ä¸­ä¸€ä¸ªéŸ³è§†é¢‘é“¾æ¥æ¥ä¸¾ä¾‹ã€‚å®ç°æ–¹å¼å¦‚ä¸‹ï¼š&lt;/p>
&lt;ol>
&lt;li>æä¾›ç”Ÿæˆm3u8æ–‡ä»¶çš„httpæœåŠ¡ï¼Œm3u8è§†é¢‘å—æ ¹æ®æ—¶é•¿(duration)åˆ‡åˆ†ä¸º5ç§’ä¸ºä¸€ç‰‡ï¼Œm3u8æ ¼å¼å¦‚ä¸‹ï¼š
&lt;pre tabindex="0">&lt;code> #EXTM3U
#EXT-X-VERSION:3
#EXT-X-MEDIA-SEQUENCE:0
#EXT-X-ALLOW-CACHE:YES
#EXT-X-TARGETDURATION:5
#EXT-X-PLAYLIST-TYPE:VOD
#EXTINF: 5.000000,
http://xxx/api/hls/segments/1
#EXTINF: 5.000000,
http://xxx/api/hls/segments/2
....
&lt;/code>&lt;/pre>æ‹¿ä¸åˆ°æ€»çš„æ—¶é•¿çš„è¯ï¼Œå¯ä»¥é€šè¿‡&lt;code>ffprobe&lt;/code>å‘½ä»¤è·å–ï¼š
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">ffprobe -v quiet -print_format json -show_format &lt;span class="s2">&amp;#34;http://xxx/video.m4s&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>httpæœåŠ¡çš„å“åº”å¤´&lt;code>content-type&lt;/code>éœ€è®¾ä¸º&lt;code>application/vnd.apple.mpegurl&lt;/code>&lt;/li>
&lt;li>æä¾›åˆ‡ç‰‡ä¸‹è½½çš„httpæœåŠ¡ï¼Œå¦‚ä¸Šé¢m3u8æ–‡ä»¶ä¸­çš„&lt;code>http://xxx/api/hls/segments/1&lt;/code>ï¼Œåˆ‡ç‰‡å¯ä»¥é€šè¿‡ffmpegè¿›è¡ŒéŸ³è§†åˆå¹¶å’Œåˆ‡åˆ†ï¼Œå‘½ä»¤å¦‚ä¸‹ï¼š
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># åˆ‡åˆ†ä»è§†é¢‘ç¬¬(-ss)5.00ç§’å¼€å§‹ï¼Œæ—¶é•¿(-t)5.00ç§’&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># -sså’Œ-initial_offsetæ•°å€¼éœ€è¦æ ¹æ®å½“å‰åˆ‡ç‰‡é€’å¢&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ffmpeg -timelimit &lt;span class="m">45&lt;/span> -ss 5.00 -i http://xxx/video.m4s -ss 5.00 -i http://xxx/audio.m4s -t 5.00 -c:v libx264 -preset veryfast -c:a copy -force_key_frames &lt;span class="s2">&amp;#34;expr:gte(t,n_forced*5.000)&amp;#34;&lt;/span> -f ssegment -segment_time 5.00 -initial_offset 5.00 pipe:out%03d.ts
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># åŒæ—¶åˆå¹¶å­—å¹•xxx.srt&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ffmpeg -timelimit &lt;span class="m">45&lt;/span> -ss 5.00 -copyts -i http://xxx/video.m4s -ss 5.00 -i http://xxx/audio.m4s -t 5.00 -vf &lt;span class="nv">subtitles&lt;/span>&lt;span class="o">=&lt;/span>xxx.srt -c:v libx264 -preset veryfast -c:a copy -force_key_frames &lt;span class="s2">&amp;#34;expr:gte(t,n_forced*5.000)&amp;#34;&lt;/span> -f ssegment -segment_time 5.00 -initial_offset 5.00 -ss 5.00 pipe:out%03d.ts
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>æœ¬å‘½ä»¤æ˜¯æŠŠé‡æ–°ç¼–ç åçš„è§†é¢‘æ•°æ®è¾“å‡ºåˆ°æ§åˆ¶å°ï¼Œéœ€è¦httpæœåŠ¡æŠŠè¾“å‡ºæ•°æ®å®æ—¶å†™å…¥åˆ°å“åº”ä¸­ï¼Œè¿™æ ·æ’­æ”¾å™¨å°±èƒ½å®æ—¶ä¸‹è½½æ’­æ”¾äº†&lt;/li>
&lt;/ol>
&lt;h2 id="ä¼šé‡åˆ°çš„é—®é¢˜">ä¼šé‡åˆ°çš„é—®é¢˜&lt;/h2>
&lt;p>ffmpegåˆ‡ç‰‡æ—¶éŸ³é¢‘ä½¿ç”¨äº†&lt;code>copy&lt;/code>å‘½ä»¤ï¼Œä½†è§†é¢‘å´ä½¿ç”¨&lt;code>libx264&lt;/code>é‡æ–°ç¼–ç ï¼Œå¯¼è‡´è½¬ç å¾ˆæ…¢ï¼Œè€Œä¸”cpuå ç”¨å±…é«˜ä¸ä¸‹ï¼Œä¸ºä»€ä¹ˆè§†é¢‘ä¸ä¹Ÿç”¨&lt;code>copy&lt;/code>æ¨¡å¼ï¼Œé¿å…é‡æ–°è½¬ç ï¼Ÿ&lt;/p>
&lt;p>è¿™æ˜¯å› ä¸ºffmpegè§†é¢‘copyæ¨¡å¼åˆ‡ç‰‡æ—¶åªèƒ½æ ¹æ®å…³é”®å¸§åˆ‡åˆ†ï¼Œè¿™æ ·ä¼šå¯¼è‡´æ¯ä¸ªåˆ‡ç‰‡å¯èƒ½ä¼šå¤šå‡ å¸§ï¼Œæ’­æ”¾æ—¶å‡ºç°ç”»é¢é‡å¤æ’­æ”¾å’Œå£°ç”»ä¸åŒæ­¥ï¼Œå…·ä½“é—®é¢˜å¯å‚è€ƒï¼š&lt;a class="link" href="https://www.jianshu.com/p/f7d83fdec111" target="_blank" rel="noopener"
>https://www.jianshu.com/p/f7d83fdec111&lt;/a>&lt;/p>
&lt;p>åˆ‡ç‰‡é‡æ–°ç¼–ç æ˜¯é¿å…ä¸äº†äº†ï¼Œå¦‚ä½•å¯ä»¥æé«˜è½¬ç é€Ÿåº¦ï¼Œé™ä½cpuå ç”¨ï¼Ÿ&lt;/p>
&lt;p>â€”â€”è§†é¢‘ç¼–ç ç¡¬ä»¶åŠ é€Ÿï¼&lt;/p>
&lt;h2 id="ffmpegç¡¬ä»¶åŠ é€Ÿ">ffmpegç¡¬ä»¶åŠ é€Ÿ&lt;/h2>
&lt;p>è§†é¢‘ç¼–ç ç¡¬ä»¶åŠ é€Ÿä¸»è¦æœ‰å¦‚ä¸‹å‡ ç§ï¼š&lt;/p>
&lt;ul>
&lt;li>VAAPIï¼šintelé›†æ˜¾æ”¯æŒï¼Œæ˜¯openwrtä¸­æœ€å¸¸è§å’Œä½¿ç”¨çš„&lt;/li>
&lt;li>QSVï¼šintelé›†æ˜¾æ”¯æŒï¼Œå¯åœ¨&lt;a class="link" href="https://ark.intel.com/content/www/cn/zh/ark/products/78867/intel-celeron-processor-j1900-2m-cache-up-to-2-42-ghz.html" target="_blank" rel="noopener"
>inteläº§å“è§„æ ¼é¡µ&lt;/a>æœç´¢è‡ªå·±çš„cpuï¼Œçœ‹ä¸‹æœ‰æ²¡æ”¯æŒ&lt;code>Quick Sync Video&lt;/code>&lt;/li>
&lt;li>NVENCï¼šnvidiaæ˜¾å¡æ”¯æŒï¼Œopenwrtä¸­ä¸€èˆ¬æ²¡ç‹¬ç«‹æ˜¾å¡ï¼Œå¾ˆå°‘ä½¿ç”¨åˆ°&lt;/li>
&lt;/ul>
&lt;p>è¿™é‡Œåªä»‹ç»æœ€å¸¸ç”¨çš„vaapiæ–¹å¼ï¼Œffmpegç¼–ç æ—¶ä½¿ç”¨vaapiç¡¬ä»¶åŠ é€Ÿåˆ‡ç‰‡å‘½ä»¤å¦‚ä¸‹ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># å¼€å¯vaapiç¡¬ä»¶åŠ é€Ÿç¼–ç &lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ffmpeg -vaapi_device /dev/dri/renderD128 -timelimit &lt;span class="m">45&lt;/span> -ss 5.00 -i http://xxx/video.m4s -ss 5.00 -i http://xxx/audio.m4s -t 5.00 -vf &lt;span class="s1">&amp;#39;format=nv12,hwupload&amp;#39;&lt;/span> -c:v h264_vaapi -c:a copy -force_key_frames &lt;span class="s2">&amp;#34;expr:gte(t,n_forced*5.000)&amp;#34;&lt;/span> -f ssegment -segment_time 5.00 -initial_offset 5.00 pipe:out%03d.ts
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># åŒæ—¶åˆå¹¶å­—å¹•xxx.srt&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ffmpeg -vaapi_device /dev/dri/renderD128 -timelimit &lt;span class="m">45&lt;/span> -ss 5.00 -copyts -i http://xxx/video.m4s -ss 5.00 -i http://xxx/audio.m4s -t 5.00 -vf &lt;span class="s1">&amp;#39;subtitles=xxx.srt,format=nv12,hwupload&amp;#39;&lt;/span> -c:v h264_vaapi -c:a copy -force_key_frames &lt;span class="s2">&amp;#34;expr:gte(t,n_forced*5.000)&amp;#34;&lt;/span> -f ssegment -segment_time 5.00 -initial_offset 5.00 -ss 5.00 pipe:out%03d.ts
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;code>-vaapi_device /dev/dri/renderD128&lt;/code>ï¼Œ&lt;code>-vf 'format=nv12,hwupload'&lt;/code>å’Œ&lt;code>-c:v h264_vaapi&lt;/code>è¿™ä¸‰ä¸ªå‚æ•°æ˜¯å¿…é¡»çš„&lt;/p>
&lt;h2 id="å¦‚ä½•åœ¨dockerä¸­ä½¿ç”¨ç¡¬ä»¶åŠ é€Ÿ">å¦‚ä½•åœ¨dockerä¸­ä½¿ç”¨ç¡¬ä»¶åŠ é€Ÿ&lt;/h2>
&lt;p>å‡å¦‚hlsæµæœåŠ¡æ˜¯éƒ¨ç½²åœ¨dockerä¸­ä½¿ç”¨çš„ï¼Œæ‰“å¼€ç¡¬ä»¶åŠ é€Ÿå¯ä»¥ä½¿ç”¨å·²ç»å®‰è£…äº†vaapiæ”¯æŒçš„é•œåƒã€‚&lt;a class="link" href="https://hub.docker.com/r/jrottenberg/ffmpeg" target="_blank" rel="noopener"
>jrottenberg/ffmpeg&lt;/a>æœ‰ç”Ÿæˆå¥½çš„æ”¯æŒvaapiçš„dockeré•œåƒï¼Œé•œåƒåç§°å¸¦æœ‰&lt;code>vaapi&lt;/code>æ ‡ç­¾ï¼Œå¯è‡ªè¡Œæœç´¢éœ€è¦çš„ffmpegç‰ˆæœ¬ä½¿ç”¨&lt;/p>
&lt;p>dockerå¯åŠ¨æ—¶ï¼Œéœ€è¦ä½¿ç”¨&lt;code>--device&lt;/code>å‚æ•°ç»‘å®šæ˜¾å¡è®¾å¤‡ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">docker run --device /dev/dri:/dev/dri jrottenberg/ffmpeg:vaapi
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>åœ¨openwrtä¸­ä½¿ç”¨çš„è¯ä¸­ï¼Œå¯åœ¨dockeré…ç½®é¡µ&lt;code>device&lt;/code>æ ç»‘å®šæ˜¾å¡è®¾å¤‡&lt;/p>
&lt;p>&lt;img src="https://blog.xenori.com/2021/11/dash-to-hls/1.jpg"
width="1104"
height="210"
srcset="https://blog.xenori.com/2021/11/dash-to-hls/1_hu3cc7554004a4f82bf46186159a47e918_23956_480x0_resize_q75_box.jpg 480w, https://blog.xenori.com/2021/11/dash-to-hls/1_hu3cc7554004a4f82bf46186159a47e918_23956_1024x0_resize_q75_box.jpg 1024w"
loading="lazy"
alt="å›¾ç‰‡"
class="gallery-image"
data-flex-grow="525"
data-flex-basis="1261px"
>&lt;/p>
&lt;h2 id="å‚è€ƒèµ„æ–™">å‚è€ƒèµ„æ–™&lt;/h2>
&lt;ul>
&lt;li>FFMPEGå‚æ•°è¯´æ˜ï¼š&lt;a class="link" href="https://ffmpeg.org/ffmpeg-all.html#Format-Options" target="_blank" rel="noopener"
>https://ffmpeg.org/ffmpeg-all.html#Format-Options&lt;/a>&lt;/li>
&lt;li>DASHåè®®ç›´æ’­åº”ç”¨ï¼š&lt;a class="link" href="https://cloud.tencent.com/developer/article/1895146" target="_blank" rel="noopener"
>https://cloud.tencent.com/developer/article/1895146&lt;/a>&lt;/li>
&lt;/ul></description></item><item><title>å„ç§å¼€å‘ç›¸å…³çš„å›½å†…æº</title><link>https://blog.xenori.com/2020/05/china-speedup-source-for-develop/</link><pubDate>Thu, 07 May 2020 11:27:10 +0800</pubDate><guid>https://blog.xenori.com/2020/05/china-speedup-source-for-develop/</guid><description>&lt;pre tabindex="0">&lt;code>é˜¿é‡Œäº‘ç»Ÿä¸€å®˜æ–¹é•œåƒç«™ï¼šhttps://developer.aliyun.com/mirror/
åŒ…å«äº†æ‰€æœ‰å¼€æºçš„å›½å†…é•œåƒæºï¼Œå¦‚homebrewï¼Œnpmï¼Œpipï¼Œcentosç­‰ï¼Œå·®ä¸å¤šæ»¡è¶³æ‰€æœ‰å¼€å‘éœ€æ±‚ï¼Œ ğŸ‚ğŸ»
&lt;/code>&lt;/pre>&lt;h2 id="go-get-å›½å†…æº">go get å›½å†…æº&lt;/h2>
&lt;p>ä¸ƒç‰›ï¼šhttps://goproxy.cn&lt;/p>
&lt;p>å®˜æ–¹å…¨çƒåŠ é€ŸCDNï¼šhttps://goproxy.io/&lt;/p>
&lt;p>ç¬¬ä¸‰æ–¹ï¼šhttps://gocenter.io&lt;/p>
&lt;h2 id="pip-å›½å†…æº">pip å›½å†…æº&lt;/h2>
&lt;p>æ¸…åï¼šhttps://pypi.tuna.tsinghua.edu.cn/simple&lt;/p>
&lt;p>é˜¿é‡Œäº‘ï¼šhttp://mirrors.aliyun.com/pypi/simple/&lt;/p>
&lt;p>ä¸­å›½ç§‘æŠ€å¤§å­¦ &lt;a class="link" href="https://pypi.mirrors.ustc.edu.cn/simple/" target="_blank" rel="noopener"
>https://pypi.mirrors.ustc.edu.cn/simple/&lt;/a>&lt;/p>
&lt;p>åä¸­ç†å·¥å¤§å­¦ï¼šhttp://pypi.hustunique.com/&lt;/p>
&lt;p>å±±ä¸œç†å·¥å¤§å­¦ï¼šhttp://pypi.sdutlinux.org/&lt;/p>
&lt;p>è±†ç“£ï¼šhttp://pypi.douban.com/simple/&lt;/p>
&lt;h3 id="ä½¿ç”¨æ–¹æ³•">ä½¿ç”¨æ–¹æ³•&lt;/h3>
&lt;p>ä¸´æ—¶ä½¿ç”¨ï¼š&lt;/p>
&lt;pre tabindex="0">&lt;code>pip install pyspider -i https://pypi.tuna.tsinghua.edu.cn/simple
&lt;/code>&lt;/pre>&lt;p>æ°¸ä¹…ä¿®æ”¹ï¼Œä¸€åŠ³æ°¸é€¸ï¼š&lt;/p>
&lt;p>Linuxä¸‹ï¼Œä¿®æ”¹ ~/.pip/pip.conf (æ²¡æœ‰å°±åˆ›å»ºä¸€ä¸ªæ–‡ä»¶å¤¹åŠæ–‡ä»¶ã€‚æ–‡ä»¶å¤¹è¦åŠ â€œ.â€ï¼Œè¡¨ç¤ºæ˜¯éšè—æ–‡ä»¶å¤¹)&lt;/p>
&lt;p>å†…å®¹å¦‚ä¸‹ï¼š&lt;/p>
&lt;pre tabindex="0">&lt;code>[global]
index-url = https://pypi.tuna.tsinghua.edu.cn/simple
[install]
trusted-host=mirrors.aliyun.com
&lt;/code>&lt;/pre>&lt;h2 id="gradleå›½å†…æº">gradleå›½å†…æº&lt;/h2>
&lt;p>é˜¿é‡Œï¼šhttp://maven.aliyun.com/nexus/content/groups/public&lt;/p>
&lt;h3 id="ä½¿ç”¨æ–¹æ³•-1">ä½¿ç”¨æ–¹æ³•&lt;/h3>
&lt;p>é…ç½®åªåœ¨å½“å‰é¡¹ç›®ç”Ÿæ•ˆï¼š
åœ¨ build.gradle æ–‡ä»¶å†…ä¿®æ”¹/æ·»åŠ  repositories é…ç½®&lt;/p>
&lt;pre tabindex="0">&lt;code>repositories {
maven {
url &amp;#34;http://maven.aliyun.com/nexus/content/groups/public&amp;#34;
}
}
&lt;/code>&lt;/pre>&lt;p>é…ç½®å…¨å±€ç”Ÿæ•ˆï¼š
æ‰¾åˆ° (ç”¨æˆ·å®¶ç›®å½•)/.gradle/init.gradle æ–‡ä»¶ï¼Œå¦‚æœæ‰¾ä¸åˆ° init.gradle æ–‡ä»¶ï¼Œè‡ªå·±æ–°å»ºä¸€ä¸ªä¿®æ”¹/æ·»åŠ  init.gradle æ–‡ä»¶å†…çš„ repositories é…ç½®&lt;/p>
&lt;pre tabindex="0">&lt;code>allprojects {
repositories {
maven {
url &amp;#34;http://maven.aliyun.com/nexus/content/groups/public&amp;#34;
}
}
}
&lt;/code>&lt;/pre></description></item></channel></rss>